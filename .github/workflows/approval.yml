name: Deployment Approval

on:
  pull_request:
    branches: [ master ]
  push:
    branches: [ master ]

jobs:
  approval:
    runs-on: ubuntu-latest
    environment:
      name: production-approval
      url: https://github.com/${{ github.repository }}/actions/workflows/deploy.yml
    steps:
      - name: Approval Check
        run: |
          echo "Deployment has been approved!"

  trigger-deploy:
    needs: approval
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Deploy Workflow
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'deploy.yml',
              ref: 'master'
            }) 